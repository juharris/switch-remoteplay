<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Switch Remoteplay</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"
		integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<style type="text/css">
		body {
			background: #333;
			color: #ddd;
		}

		div.connection-status,
		div.status {
			min-height: 30px;
		}
	</style>
	<script type="text/javascript" charset="utf-8">
		let socket
		$(document).ready(function () {
			const queryString = window.location.search
			const urlParams = new URLSearchParams(queryString)
			const address = urlParams.get('a') || 'http://127.0.0.1:5000'
			let status = `Connecting to "${address}"...`
			console.debug(status)
			$('#connection-status').text(status)
			socket = io(address)

			socket.on('connect', function (data) {
				$('#connection-status').text("✅ Connected")
				console.log(data)
			})

			socket.on('disconnect', function () {
				$('#connection-status').text("❌ Disconnected")
				console.warn("Disconnected")
			})
		})

		function sendCommand(command) {
			$('#status').text(`emitting ${command}`)
			socket.emit('p', command, (data) => {
				$('#status').text("p responded: " + data)
			})
		}

		const keyMappingOnDown = {
			ArrowLeft: 'left d',
			ArrowRight: 'right d',
			ArrowUp: 'up d',
			ArrowDown: 'down d',
			KeyA: 's l left',
			KeyD: 's l right',
			KeyS: 's l down',
			KeyW: 's l up',
			Space: 'b d',
			KeyE: 'x d',
			KeyQ: 'y d',
		}

		const keyMappingOnUp = {
			ArrowLeft: 'left u',
			ArrowRight: 'right u',
			ArrowUp: 'up u',
			ArrowDown: 'down u',
			KeyA: 's l center',
			KeyD: 's l center',
			KeyS: 's l center',
			KeyW: 's l center',
			Space: 'b u',
			KeyE: 'x u',
			KeyQ: 'y u',
		}

		const keyMappingPress = {
			
		}

		document.addEventListener('keydown', function (e) {
			const command = keyMappingOnDown[e.code]
			if (command) {
				sendCommand(command)
			} else if(!(e.code in keyMappingPress) && !(e.code in keyMappingOnUp)) {
				console.warn(`keydown: Unknown command: ${e.code}`)
			}
		})
		document.addEventListener('keyup', function (e) {
			const command = keyMappingOnUp[e.code]
			if (command) {
				sendCommand(command)
			} else if (!(e.code in keyMappingOnDown) && !(e.code in keyMappingPress)) {
				console.warn(`keyup: Unknown command: ${e.code}`)
			}
		})

		document.addEventListener('keypress', function (e) {
			const command = keyMappingPress[e.code]
			if (command) {
				sendCommand(command)
			} else if (!(e.code in keyMappingOnDown) && !(e.code in keyMappingOnUp)) {
				console.warn(`keypress: Unknown command: ${e.code}`)
			}
		})

		document.onclick = function (e) {
			sendCommand('a')
		}
	</script>
</head>

<body>
	<div class="connection-status">
		Connection status: <span id="connection-status"></span>
	</div>
	<div class="status">
		Status: <span id="status"></span>
	</div>
	<div>
		<!-- <button onclick="my_message()">my_message</button> -->
	</div>
</body>

</html>